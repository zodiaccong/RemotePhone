<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Remote Screen Viewer - Multi Device</title>
    <style>
        /* STYLE CHO PH√ÇN TRANG - ƒê·∫∂T RI√äNG BI·ªÜT */
        .pagination-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(0, 0, 0, 0.9);
            padding: 12px 18px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            z-index: 1001; /* CAO H∆†N ƒëi·ªán tho·∫°i */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            pointer-events: auto; /* QUAN TR·ªåNG: Cho ph√©p t∆∞∆°ng t√°c */
        }

        .pagination-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: rgba(102, 126, 234, 0.2);
            border: 2px solid rgba(102, 126, 234, 0.5);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s ease;
            user-select: none;
            pointer-events: auto; /* QUAN TR·ªåNG: Cho ph√©p t∆∞∆°ng t√°c */
        }

        .pagination-btn:hover {
            background: rgba(102, 126, 234, 0.4);
            border-color: rgba(102, 126, 234, 0.8);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .pagination-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.2);
        }

        .pagination-btn.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            background: rgba(102, 126, 234, 0.1);
            border-color: rgba(102, 126, 234, 0.2);
            pointer-events: none; /* V√¥ hi·ªáu h√≥a t∆∞∆°ng t√°c khi disabled */
        }

        .pagination-btn.disabled:hover {
            transform: none;
            background: rgba(102, 126, 234, 0.1);
            border-color: rgba(102, 126, 234, 0.2);
            box-shadow: none;
        }

        .page-indicator {
            color: white;
            font-size: 14px;
            font-weight: 600;
            min-width: 100px;
            text-align: center;
            padding: 0 10px;
            pointer-events: none; /* Ch·ªâ hi·ªÉn th·ªã, kh√¥ng t∆∞∆°ng t√°c */
        }

        .page-info {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 2px;
            pointer-events: none;
        }

        .devices-count {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            z-index: 1001; /* CAO H∆†N ƒëi·ªán tho·∫°i */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            pointer-events: none; /* Ch·ªâ hi·ªÉn th·ªã, kh√¥ng t∆∞∆°ng t√°c */
        }

        .devices-count .count {
            color: #667eea;
            font-size: 16px;
            margin-left: 4px;
        }

        .devices-count .page-count {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 2px;
        }

        /* ƒê·∫£m b·∫£o ƒëi·ªán tho·∫°i c√≥ z-index th·∫•p h∆°n */
        .phone-frame {
            width: 320px;
            height: 680px;
            background: #222;
            border-radius: 36px;
            padding: 12px;
            box-shadow:
                0 0 0 2px #333,
                0 20px 50px rgba(0,0,0,0.5),
                inset 0 0 10px rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            user-select: none;
            touch-action: none;
            z-index: 100; /* TH·∫§P H∆†N controls ph√¢n trang */
            transition: box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
            pointer-events: auto; /* ƒêi·ªán tho·∫°i v·∫´n nh·∫≠n touch */
        }

        /* S·ª≠a l·∫°i ƒë·ªÉ m√†n h√¨nh ƒëi·ªán tho·∫°i ch·ªâ nh·∫≠n touch b√™n trong */
        .phone-screen {
            flex: 1;
            background: #000;
            border-radius: 24px;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            touch-action: none;
            min-width: 100%;
            min-height: 100%;
            pointer-events: auto; /* M√†n h√¨nh ƒëi·ªán tho·∫°i nh·∫≠n touch */
        }

        /* Container ch√≠nh - ƒê·∫¢M B·∫¢O KH√îNG CH·∫∂N TOUCH */
        .screen-container {
            flex: 1;
            background: #1a1a1a;
            position: relative;
            overflow: auto;
            min-height: 0;
            padding: 20px;
            /* KH√îNG c√≥ pointer-events: none; */
        }

        /* ƒê·∫£m b·∫£o c√°c ph·∫ßn t·ª≠ b√™n trong ƒëi·ªán tho·∫°i ch·ªâ nh·∫≠n touch khi c·∫ßn */
        .screen-image-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            pointer-events: auto; /* Container ·∫£nh nh·∫≠n touch */
        }

        .screen-image {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            touch-action: none;
            cursor: pointer;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            margin: auto;
            background: #000;
            pointer-events: auto; /* ·∫¢nh nh·∫≠n touch */
        }

        /* Th√™m l·ªõp overlay ƒë·ªÉ ch·∫∑n touch khi c·∫ßn - nh∆∞ng kh√¥ng d√πng ·ªü ƒë√¢y */
        .touch-blocker {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent;
            z-index: 9999;
            pointer-events: none; /* M·∫∑c ƒë·ªãnh kh√¥ng ch·∫∑n */
        }

        .touch-blocker.active {
            pointer-events: auto; /* Ch·ªâ ch·∫∑n khi active */
        }

        /* ƒê·∫£m b·∫£o c√°c n√∫t ƒëi·ªÅu khi·ªÉn ƒëi·ªán tho·∫°i v·∫´n ho·∫°t ƒë·ªông */
        .phone-controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 12px 16px;
            background: rgba(30, 30, 30, 0.95);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow:
                0 -4px 20px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border-radius: 0 0 24px 24px;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 50;
            gap: 12px;
            min-height: 70px;
            transform: translateZ(0);
            pointer-events: auto; /* N√∫t ƒëi·ªÅu khi·ªÉn nh·∫≠n touch */
        }

        /* Responsive cho ph√¢n trang */
        @media (max-width: 768px) {
            .pagination-controls {
                bottom: 10px;
                right: 10px;
                padding: 10px 14px;
                gap: 8px;
                /* Tr√™n mobile, ƒë·∫∑t ·ªü gi·ªØa ƒë·ªÉ kh√¥ng ch·∫°m v√†o ƒëi·ªán tho·∫°i */
                left: 50%;
                right: auto;
                transform: translateX(-50%);
                width: auto;
                min-width: 300px;
            }

            .pagination-btn {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }

            .page-indicator {
                font-size: 12px;
                min-width: 80px;
            }

            .devices-count {
                top: 10px;
                right: 10px;
                padding: 6px 12px;
                font-size: 12px;
            }

            .devices-count .count {
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .pagination-controls {
                min-width: 280px;
                bottom: 15px;
            }

            .devices-count {
                left: 10px;
                right: auto;
                top: 10px;
                max-width: 150px;
            }
        }

        /* T·∫•t c·∫£ style c≈© v·∫´n gi·ªØ nguy√™n */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            overflow: hidden;
        }

        .container {
            max-width: 100%;
            height: 100vh;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 20px;
            text-align: center;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 22px;
            margin-bottom: 4px;
        }

        .header p {
            font-size: 13px;
            opacity: 0.9;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            flex-wrap: wrap;
            gap: 10px;
            flex-shrink: 0;
        }

        .server-info {
            font-size: 13px;
            color: #666;
        }

        .status {
            padding: 6px 16px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 12px;
            white-space: nowrap;
        }

        .status.connected {
            background: #10b981;
            color: white;
            box-shadow: 0 2px 10px rgba(16, 185, 129, 0.3);
        }

        .status.disconnected {
            background: #ef4444;
            color: white;
            box-shadow: 0 2px 10px rgba(239, 68, 68, 0.3);
        }

        .main-content {
            display: flex;
            flex: 1;
            min-height: 0;
            position: relative;
        }

        /* Grid layout cho ph√¢n trang */
        .phones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            justify-items: center;
            align-items: start;
            width: 100%;
            transition: opacity 0.3s ease;
        }

        .phones-grid.page-transition {
            opacity: 0.5;
        }

        /* Hi·ªáu ·ª©ng cho ƒëi·ªán tho·∫°i */
        .phone-frame {
            animation: phoneAppear 0.5s ease forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes phoneAppear {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Hi·ªáu ·ª©ng chuy·ªÉn trang */
        .page-transition {
            animation: pageTransition 0.3s ease;
        }

        @keyframes pageTransition {
            from {
                opacity: 0;
                transform: translateX(10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Th√™m style cho th√¥ng b√°o kh√¥ng c√≥ thi·∫øt b·ªã */
        .no-devices-message {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            font-size: 16px;
            grid-column: 1 / -1;
        }

        .no-devices-message h3 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #999;
        }

        .no-devices-message p {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .refresh-btn {
            margin-top: 20px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .phone-notch {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            height: 24px;
            background: #222;
            border-bottom-left-radius: 16px;
            border-bottom-right-radius: 16px;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 4px;
        }

        .phone-notch::before {
            content: '';
            width: 80px;
            height: 6px;
            background: #333;
            border-radius: 3px;
        }

        .touch-indicator {
            position: absolute;
            width: 20px;
            height: 20px;
            background: rgba(102, 126, 234, 0.6);
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            pointer-events: none;
            z-index: 150;
            transform: translate(-50%, -50%);
            animation: touchPulse 0.3s ease-out;
        }

        @keyframes touchPulse {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0;
            }
        }

        .swipe-trail {
            position: absolute;
            background: rgba(102, 126, 234, 0.4);
            border-radius: 10px;
            pointer-events: none;
            z-index: 149;
            transform-origin: left center;
        }

        .gesture-indicator {
            position: absolute;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 200;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(10px);
            white-space: nowrap;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
        }

        .gesture-rotate {
            top: 50px;
        }

        .phone-status-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 32px;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 16px;
            color: white;
            font-size: 11px;
            z-index: 100;
            backdrop-filter: blur(5px);
            border-radius: 24px 24px 0 0;
        }

        .device-info {
            display: flex;
            align-items: center;
            gap: 6px;
            max-width: 40%;
            overflow: hidden;
        }

        .device-icon {
            font-size: 12px;
            flex-shrink: 0;
        }

        .device-name {
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .latency-info {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .latency-icon {
            font-size: 12px;
            flex-shrink: 0;
        }

        .latency-value {
            font-weight: 600;
            font-size: 11px;
        }

        .latency-good {
            color: #10b981;
        }

        .latency-medium {
            color: #f59e0b;
        }

        .latency-poor {
            color: #ef4444;
        }

        .connection-quality {
            font-size: 10px;
            opacity: 0.8;
            text-align: right;
            min-width: 80px;
        }

        .phone-buttons {
            position: absolute;
            right: -8px;
            top: 120px;
            display: flex;
            flex-direction: column;
            gap: 40px;
        }

        .volume-button, .power-button {
            width: 4px;
            height: 40px;
            background: #444;
            border-radius: 2px;
        }

        .power-button {
            height: 60px;
            margin-top: 60px;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(50, 50, 50, 0.95);
            border: 2px solid rgba(100, 100, 100, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            color: white;
            font-size: 22px;
            box-shadow:
                0 3px 8px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.1);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
            pointer-events: auto;
        }

        .control-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(255,255,255,0.15) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(70, 70, 70, 0.95);
            border-color: rgba(150, 150, 150, 0.7);
            transform: translateY(-2px) scale(1.05);
            box-shadow:
                0 6px 15px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }

        .control-btn:active {
            transform: translateY(0) scale(0.95);
            box-shadow:
                0 2px 5px rgba(0,0,0,0.3),
                inset 0 2px 5px rgba(0,0,0,0.4);
        }

        .control-btn:active::after {
            opacity: 1;
        }

        .control-btn.home {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            border-color: rgba(124, 58, 237, 0.3);
            box-shadow:
                0 3px 12px rgba(124, 58, 237, 0.4),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }

        .control-btn.home:hover {
            background: linear-gradient(135deg, #5f56e5 0%, #8c4aed 100%);
            border-color: rgba(140, 74, 237, 0.5);
            box-shadow:
                0 6px 20px rgba(124, 58, 237, 0.6),
                inset 0 1px 0 rgba(255,255,255,0.3);
        }

        .control-btn.back {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            border-color: rgba(16, 185, 129, 0.3);
            box-shadow:
                0 3px 12px rgba(16, 185, 129, 0.4),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }

        .control-btn.back:hover {
            background: linear-gradient(135deg, #15a669 0%, #20c991 100%);
            border-color: rgba(32, 201, 145, 0.5);
            box-shadow:
                0 6px 20px rgba(16, 185, 129, 0.6),
                inset 0 1px 0 rgba(255,255,255,0.3);
        }

        .control-btn.recent {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
            border-color: rgba(239, 68, 68, 0.3);
            box-shadow:
                0 3px 12px rgba(239, 68, 68, 0.4),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }

        .control-btn.recent:hover {
            background: linear-gradient(135deg, #ec3636 0%, #ff5454 100%);
            border-color: rgba(255, 84, 84, 0.5);
            box-shadow:
                0 6px 20px rgba(239, 68, 68, 0.6),
                inset 0 1px 0 rgba(255,255,255,0.3);
        }

        /* Tooltip cho desktop */
        .control-btn[title] {
            position: relative;
        }

        .control-btn[title]:hover::before {
            content: attr(title);
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .control-btn[title]:hover::after {
            content: '';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.9) transparent transparent transparent;
        }

        .no-connection {
            color: #999;
            text-align: center;
            padding: 30px 20px;
            max-width: 450px;
        }

        .no-connection h3 {
            font-size: 20px;
            margin-bottom: 12px;
            color: #ccc;
        }

        .no-connection p {
            font-size: 13px;
            line-height: 1.6;
            margin: 8px 0;
        }

        /* RESPONSIVE - MOBILE */
        @media (max-width: 768px) {
            body {
                -webkit-text-size-adjust: 100%;
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
                padding-bottom: 20px;
            }

            .container {
                border-radius: 0;
                box-shadow: none;
                height: 100vh;
                padding-bottom: 20px;
            }

            .header h1 {
                font-size: 20px;
            }

            .header p {
                font-size: 12px;
            }

            .status-bar {
                padding: 12px;
            }

            .main-content {
                flex-direction: column;
            }

            .screen-container {
                flex: 1;
                min-height: 0;
                padding: 10px;
                padding-bottom: 80px; /* Th√™m padding ƒë·ªÉ tr√°nh ph√¢n trang */
            }

            .phones-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                padding-bottom: 20px;
            }

            .phone-frame {
                width: 280px;
                height: 600px;
                margin-bottom: 20px;
            }

            .phone-controls {
                padding: 10px 14px;
                gap: 10px;
                min-height: 65px;
                border-radius: 0 0 20px 20px;
            }

            .control-btn {
                width: 46px;
                height: 46px;
                font-size: 20px;
                border-width: 1.5px;
            }

            .control-btn:hover {
                transform: translateY(-1px) scale(1.03);
            }

            .control-btn:active {
                transform: translateY(0) scale(0.94);
            }

            /* ·∫®n tooltip tr√™n mobile ƒë·ªÉ tr√°nh xung ƒë·ªôt v·ªõi touch */
            .control-btn[title]:hover::before,
            .control-btn[title]:hover::after {
                display: none;
            }

            .screen-image {
                -webkit-user-select: none;
                -webkit-touch-callout: none;
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
            }

            .phone-screen {
                -webkit-overflow-scrolling: touch;
                overscroll-behavior: none;
            }

            .phone-status-bar {
                height: 30px;
                padding: 0 12px;
                font-size: 10px;
            }

            .device-name {
                max-width: 70px;
            }

            .no-connection {
                padding: 20px;
            }

            .no-connection h3 {
                font-size: 18px;
            }

            .no-connection p {
                font-size: 13px;
            }
        }

        /* TABLET */
        @media (min-width: 769px) and (max-width: 1024px) {
            .phones-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .phone-controls {
                padding: 12px 16px;
                gap: 14px;
            }

            .control-btn {
                width: 48px;
                height: 48px;
                font-size: 21px;
            }
        }

        /* LARGE SCREEN */
        @media (min-width: 1025px) {
            .phones-grid {
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="status-bar">
            <div id="status" class="status disconnected">
                üîÑ ƒêang k·∫øt n·ªëi...
            </div>
        </div>

        <div class="main-content">
            <div class="screen-container" id="screenContainer">
                <!-- Th√™m b·ªô ƒë·∫øm thi·∫øt b·ªã -->
                <div class="devices-count">
                    <div class="count">0 thi·∫øt b·ªã</div>
                    <div class="page-count">Trang <span id="currentPage">1</span>/<span id="totalPages">1</span></div>
                </div>

                <!-- Grid hi·ªÉn th·ªã ƒëi·ªán tho·∫°i -->
                <div class="phones-grid" id="phonesGrid">
                    <!-- C√°c ƒëi·ªán tho·∫°i s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
                </div>

                <!-- Th√™m ph·∫ßn t·ª≠ cho th√¥ng b√°o kh√¥ng c√≥ thi·∫øt b·ªã -->
                <div id="noDevicesMessage" class="no-devices-message" style="display: none;">
                    <h3>üì± Kh√¥ng c√≥ thi·∫øt b·ªã n√†o k·∫øt n·ªëi</h3>
                    <p>Hi·ªán t·∫°i kh√¥ng c√≥ thi·∫øt b·ªã n√†o ƒëang k·∫øt n·ªëi ƒë·∫øn server.</p>
                    <p>H√£y ƒë·∫£m b·∫£o c√°c thi·∫øt b·ªã ƒë√£ ƒë∆∞·ª£c k·∫øt n·ªëi v√† ch·∫°y ·ª©ng d·ª•ng Remote Screen.</p>
                    <button class="refresh-btn" onclick="viewer.refreshDevicesList()">üîÑ L√†m m·ªõi danh s√°ch</button>
                </div>
            </div>
        </div>

        <!-- Th√™m controls ph√¢n trang -->
        <div class="pagination-controls">
            <div class="pagination-btn" id="firstPage" title="V·ªÅ trang ƒë·∫ßu">
                ¬´
            </div>
            <div class="pagination-btn" id="prevPage" title="Trang tr∆∞·ªõc">
                ‚Äπ
            </div>
            <div class="page-indicator">
                Trang <span id="pageNum">1</span>
                <div class="page-info" id="pageInfo">0-0 c·ªßa 0 thi·∫øt b·ªã</div>
            </div>
            <div class="pagination-btn" id="nextPage" title="Trang ti·∫øp">
                ‚Ä∫
            </div>
            <div class="pagination-btn" id="lastPage" title="ƒê·∫øn trang cu·ªëi">
                ¬ª
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        class RemoteViewer {
            constructor() {
                this.socket = null;
                this.isConnected = false;
                this.selectedDevice = null;
                this.selectedDeviceInfo = null;
                this.latency = 0;
                this.devices = [];
                this.phoneElements = new Map();

                // Bi·∫øn cho c·ª≠ ch·ªâ ƒëa ƒëi·ªÉm
                this.touches = new Map();
                this.activeGestures = new Set();
                this.lastTouchTime = 0;
                this.doubleTapTimeout = null;
                this.deviceLatencies = new Map();
                this.deviceStatuses = new Map();

                // Bi·∫øn cho ph√¢n trang
                this.currentPage = 1;
                this.devicesPerPage = 1;
                this.totalPages = 1;
                this.visibleDevices = new Set();

                this.init();
            }

            init() {
                this.connectToServer();
                this.startLatencyCheck();
                this.updatePhoneStatus();
                this.setupGestureEvents();
                this.setupPaginationControls();
            }

            setupPaginationControls() {
                const firstPage = document.getElementById('firstPage');
                const prevPage = document.getElementById('prevPage');
                const nextPage = document.getElementById('nextPage');
                const lastPage = document.getElementById('lastPage');

                firstPage.addEventListener('click', () => this.goToPage(1));
                prevPage.addEventListener('click', () => this.goToPage(this.currentPage - 1));
                nextPage.addEventListener('click', () => this.goToPage(this.currentPage + 1));
                lastPage.addEventListener('click', () => this.goToPage(this.totalPages));

                // Th√™m s·ª± ki·ªán b√†n ph√≠m cho ph√¢n trang
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        if (e.key === 'ArrowLeft' || e.key === 'PageUp') {
                            e.preventDefault();
                            this.goToPage(this.currentPage - 1);
                        } else if (e.key === 'ArrowRight' || e.key === 'PageDown') {
                            e.preventDefault();
                            this.goToPage(this.currentPage + 1);
                        } else if (e.key === 'Home') {
                            e.preventDefault();
                            this.goToPage(1);
                        } else if (e.key === 'End') {
                            e.preventDefault();
                            this.goToPage(this.totalPages);
                        }
                    }
                });

                // Kh·ªüi t·∫°o tr·∫°ng th√°i ph√¢n trang
                this.updatePaginationControls();
            }

            setupGestureEvents() {
                // S·ª± ki·ªán s·∫Ω ƒë∆∞·ª£c th√™m v√†o t·ª´ng ƒëi·ªán tho·∫°i ri√™ng bi·ªát
            }

            updatePhoneStatusForDevice(deviceId) {
                const phoneElement = this.phoneElements.get(deviceId);
                if (!phoneElement) return;

                // Ch·ªâ c·∫≠p nh·∫≠t n·∫øu device ƒëang hi·ªÉn th·ªã tr√™n trang hi·ªán t·∫°i
                if (!this.visibleDevices.has(deviceId)) {
                    return;
                }

                const deviceNameElement = phoneElement.querySelector('.device-name');
                const latencyElement = phoneElement.querySelector('.latency-value');
                const qualityElement = phoneElement.querySelector('.connection-quality');

                const device = this.devices.find(d => d.id === deviceId);

                if (device) {
                    deviceNameElement.textContent = device.name || 'Unknown Device';
                }

                const deviceLatency = this.deviceLatencies.get(deviceId) || 0;
                const deviceStatus = this.deviceStatuses.get(deviceId) || 'Ch∆∞a k·∫øt n·ªëi';

                let qualityText, qualityClass;

                if (deviceStatus !== 'ƒê√£ k·∫øt n·ªëi' && deviceStatus !== 'ƒêang ho·∫°t ƒë·ªông') {
                    latencyElement.textContent = '--ms';
                    latencyElement.className = 'latency-value latency-medium';
                    qualityElement.textContent = deviceStatus;
                    qualityElement.className = 'connection-quality latency-medium';
                } else if (deviceLatency === 0) {
                    qualityText = 'ƒêang ƒëo...';
                    qualityClass = 'latency-medium';
                } else if (deviceLatency < 100) {
                    qualityText = 'K·∫øt n·ªëi t·ªët';
                    qualityClass = 'latency-good';
                } else if (deviceLatency < 300) {
                    qualityText = 'K·∫øt n·ªëi trung b√¨nh';
                    qualityClass = 'latency-medium';
                } else {
                    qualityText = 'K·∫øt n·ªëi k√©m';
                    qualityClass = 'latency-poor';
                }

                if (deviceStatus === 'ƒê√£ k·∫øt n·ªëi' || deviceStatus === 'ƒêang ho·∫°t ƒë·ªông') {
                    latencyElement.textContent = deviceLatency > 0 ? `${deviceLatency}ms` : '--ms';
                    latencyElement.className = `latency-value ${qualityClass}`;
                    qualityElement.textContent = qualityText;
                    qualityElement.className = `connection-quality ${qualityClass}`;
                }
            }

            updateDeviceLatency(deviceId, latency) {
                this.deviceLatencies.set(deviceId, latency);
                this.updatePhoneStatusForDevice(deviceId);
            }

            updateDeviceStatus(deviceId, status) {
                this.deviceStatuses.set(deviceId, status);
                this.updatePhoneStatusForDevice(deviceId);
            }

            // T·∫•t c·∫£ c√°c ph∆∞∆°ng th·ª©c kh√°c v·∫´n gi·ªØ nguy√™n...

            // TH√äM PH∆Ø∆†NG TH·ª®C PH√ÇN TRANG
            goToPage(pageNumber) {
                if (pageNumber < 1 || pageNumber > this.totalPages || pageNumber === this.currentPage) {
                    return;
                }

                // Th√™m hi·ªáu ·ª©ng chuy·ªÉn trang
                const phonesGrid = document.getElementById('phonesGrid');
                phonesGrid.classList.add('page-transition');

                this.currentPage = pageNumber;
                this.renderCurrentPage();

                setTimeout(() => {
                    phonesGrid.classList.remove('page-transition');
                    phonesGrid.classList.add('page-transition');
                    setTimeout(() => {
                        phonesGrid.classList.remove('page-transition');
                    }, 300);
                }, 100);

                // Cu·ªôn l√™n ƒë·∫ßu trang
                document.querySelector('.screen-container').scrollTop = 0;

                // C·∫≠p nh·∫≠t controls
                this.updatePaginationControls();
            }

            renderCurrentPage() {
                const phonesGrid = document.getElementById('phonesGrid');
                phonesGrid.innerHTML = '';
                this.visibleDevices.clear();

                if (this.devices.length === 0) {
                    document.getElementById('noDevicesMessage').style.display = 'block';
                    phonesGrid.style.display = 'none';
                    return;
                }

                document.getElementById('noDevicesMessage').style.display = 'none';
                phonesGrid.style.display = 'grid';

                // T√≠nh to√°n devices cho trang hi·ªán t·∫°i
                const startIndex = (this.currentPage - 1) * this.devicesPerPage;
                const endIndex = Math.min(startIndex + this.devicesPerPage, this.devices.length);
                const devicesForPage = this.devices.slice(startIndex, endIndex);

                // Render c√°c devices cho trang hi·ªán t·∫°i
                devicesForPage.forEach(device => {
                    const phoneElement = this.createPhoneElement(device.id);
                    if (phoneElement) {
                        phonesGrid.appendChild(phoneElement);
                        this.visibleDevices.add(device.id);
                    }
                });

                // C·∫≠p nh·∫≠t th√¥ng tin trang
                this.updatePageInfo();
                this.updateDevicesCount();
            }

            updatePageInfo() {
                const totalDevices = this.devices.length;
                const startIndex = (this.currentPage - 1) * this.devicesPerPage + 1;
                const endIndex = Math.min(startIndex + this.devicesPerPage - 1, totalDevices);

                document.getElementById('pageNum').textContent = this.currentPage;
                document.getElementById('pageInfo').textContent =
                    totalDevices > 0 ? `${startIndex}-${endIndex} c·ªßa ${totalDevices} thi·∫øt b·ªã` : '0-0 c·ªßa 0 thi·∫øt b·ªã';
            }

            updateDevicesCount() {
                const countElement = document.querySelector('.devices-count .count');
                const currentPageElement = document.getElementById('currentPage');
                const totalPagesElement = document.getElementById('totalPages');

                if (countElement) {
                    countElement.textContent = `${this.devices.length} thi·∫øt b·ªã`;
                }
                if (currentPageElement) {
                    currentPageElement.textContent = this.currentPage;
                }
                if (totalPagesElement) {
                    totalPagesElement.textContent = this.totalPages;
                }
            }

            updatePaginationControls() {
                const firstPage = document.getElementById('firstPage');
                const prevPage = document.getElementById('prevPage');
                const nextPage = document.getElementById('nextPage');
                const lastPage = document.getElementById('lastPage');

                // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t
                firstPage.classList.toggle('disabled', this.currentPage === 1);
                prevPage.classList.toggle('disabled', this.currentPage === 1);
                nextPage.classList.toggle('disabled', this.currentPage === this.totalPages);
                lastPage.classList.toggle('disabled', this.currentPage === this.totalPages);

                // C·∫≠p nh·∫≠t t·ªïng s·ªë trang
                this.totalPages = Math.max(1, Math.ceil(this.devices.length / this.devicesPerPage));
                this.updatePageInfo();
                this.updateDevicesCount();
            }

            updateDevicesList(devices) {
                this.devices = devices;

                // T√≠nh to√°n l·∫°i ph√¢n trang
                this.totalPages = Math.max(1, Math.ceil(devices.length / this.devicesPerPage));

                // N·∫øu trang hi·ªán t·∫°i kh√¥ng h·ª£p l·ªá sau khi c·∫≠p nh·∫≠t
                if (this.currentPage > this.totalPages) {
                    this.currentPage = this.totalPages;
                }

                // Render l·∫°i trang hi·ªán t·∫°i
                this.renderCurrentPage();

                // C·∫≠p nh·∫≠t controls ph√¢n trang
                this.updatePaginationControls();

                // C·∫≠p nh·∫≠t tr·∫°ng th√°i cho t·∫•t c·∫£ devices
                devices.forEach(device => {
                    this.updateDeviceStatus(device.id, 'ƒê√£ k·∫øt n·ªëi');
                    this.updateDeviceLatency(device.id, 0);
                });
            }

            // C·∫≠p nh·∫≠t ph∆∞∆°ng th·ª©c updateScreen ƒë·ªÉ ch·ªâ c·∫≠p nh·∫≠t n·∫øu device ƒëang hi·ªÉn th·ªã
            updateScreen(imageData, deviceId) {
                // Ch·ªâ c·∫≠p nh·∫≠t n·∫øu device ƒëang hi·ªÉn th·ªã tr√™n trang hi·ªán t·∫°i
                if (!this.visibleDevices.has(deviceId)) {
                    return;
                }

                let phoneElement = this.phoneElements.get(deviceId);

                if (!phoneElement) {
                    const device = this.devices.find(d => d.id === deviceId);

                    if (!device) {
                        this.devices.push({
                            id: deviceId,
                            name: `Device ${deviceId.substring(0, 8)}...`,
                            screen_width: 1080,
                            screen_height: 1920
                        });
                    }

                    phoneElement = this.createPhoneElement(deviceId);
                }

                if (phoneElement) {
                    const screenImage = phoneElement.querySelector('.screen-image');
                    const noConnection = phoneElement.querySelector('.no-connection');

                    if (imageData) {
                        screenImage.onload = () => {
                            console.log('üñºÔ∏è ·∫¢nh ƒë√£ load:', {
                                'Device': deviceId,
                                'K√≠ch th∆∞·ªõc th·ª±c': `${screenImage.naturalWidth}x${screenImage.naturalHeight}`,
                                'K√≠ch th∆∞·ªõc hi·ªÉn th·ªã': `${screenImage.offsetWidth}x${screenImage.offsetHeight}`,
                                'T·ª∑ l·ªá scale': {
                                    x: (screenImage.naturalWidth / screenImage.offsetWidth).toFixed(2),
                                    y: (screenImage.naturalHeight / screenImage.offsetHeight).toFixed(2)
                                }
                            });
                        };

                        screenImage.src = 'data:image/jpeg;base64,' + imageData;
                        screenImage.style.display = 'block';
                        if (noConnection) noConnection.style.display = 'none';
                    }
                }
            }

            createPhoneElement(deviceId) {
                // Ki·ªÉm tra xem ƒëi·ªán tho·∫°i ƒë√£ t·ªìn t·∫°i ch∆∞a
                if (this.phoneElements.has(deviceId)) {
                    console.log('‚ö†Ô∏è ƒêi·ªán tho·∫°i ƒë√£ t·ªìn t·∫°i, b·ªè qua:', deviceId);
                    return this.phoneElements.get(deviceId);
                }

                const phonesGrid = document.getElementById('phonesGrid');

                // T√¨m th√¥ng tin thi·∫øt b·ªã t·ª´ danh s√°ch
                let device = this.devices.find(d => d.id === deviceId);

                // N·∫øu kh√¥ng t√¨m th·∫•y, t·∫°o object m·∫∑c ƒë·ªãnh
                if (!device) {
                    console.log('‚ö†Ô∏è T·∫°o thi·∫øt b·ªã m·∫∑c ƒë·ªãnh cho:', deviceId);
                    device = {
                        id: deviceId,
                        name: `Device ${deviceId.substring(0, 8)}...`,
                        screen_width: 1080,
                        screen_height: 1920
                    };

                    // Th√™m v√†o danh s√°ch devices
                    this.devices.push(device);
                }

                // Ki·ªÉm tra xem element DOM ƒë√£ t·ªìn t·∫°i ch∆∞a
                const existingElement = document.getElementById(`phone-${deviceId}`);
                if (existingElement) {
                    console.log('‚ö†Ô∏è Element DOM ƒë√£ t·ªìn t·∫°i, b·ªè qua:', deviceId);
                    this.phoneElements.set(deviceId, existingElement);
                    return existingElement;
                }

                // T·∫°o element ƒëi·ªán tho·∫°i m·ªõi
                const phoneElement = document.createElement('div');
                phoneElement.className = 'phone-frame';
                phoneElement.id = `phone-${deviceId}`;

                // S·ª≠ d·ª•ng optional chaining v√† fallback ƒë·ªÉ tr√°nh l·ªói undefined
                phoneElement.innerHTML = `
                    <div class="phone-screen">
                        <!-- Thanh tr·∫°ng th√°i v·ªõi t√™n thi·∫øt b·ªã v√† ƒë·ªô tr·ªÖ -->
                        <div class="phone-status-bar">
                            <div class="device-info">
                                <span class="device-name">${device?.name || `Device ${deviceId.substring(0, 8)}...`}</span>
                            </div>
                            <div class="latency-info">
                                <span class="latency-value">--ms</span>
                            </div>
                            <div class="connection-quality">Ch∆∞a k·∫øt n·ªëi</div>
                        </div>

                        <!-- Container cho ·∫£nh m√†n h√¨nh - CH·ªà container n√†y nh·∫≠n touch -->
                        <div class="screen-image-container" id="screen-container-${deviceId}">
                            <img class="screen-image" src="" alt="Remote Screen" style="display: none;">
                            <div class="no-connection">
                                <h3>‚è≥ ƒêang ch·ªù d·ªØ li·ªáu...</h3>
                                <p>Thi·∫øt b·ªã: ${device?.name || `Device ${deviceId.substring(0, 8)}...`}</p>
                                <p>K√≠ch th∆∞·ªõc: ${device?.screen_width || 1080}x${device?.screen_height || 1920}</p>
                            </div>
                        </div>

                        <!-- C√°c n√∫t ƒëi·ªÅu khi·ªÉn ·ªü d∆∞·ªõi c√πng m√†n h√¨nh - RI√äNG BI·ªÜT v·ªõi touch m√†n h√¨nh -->
                        <div class="phone-controls" id="phone-controls-${deviceId}">
                            <div class="control-btn recent" data-key="recent" title="Recent Apps">
                                ‚ò∞
                            </div>
                            <div class="control-btn home" data-key="home" title="Home">
                                ‚åÇ
                            </div>
                            <div class="control-btn back" data-key="back" title="Back">
                                ‚óÄ
                            </div>
                        </div>
                    </div>

                    <div class="phone-buttons">
                        <div class="volume-button"></div>
                        <div class="volume-button"></div>
                        <div class="power-button"></div>
                    </div>
                `;

                phonesGrid.appendChild(phoneElement);
                this.phoneElements.set(deviceId, phoneElement);

                // Thi·∫øt l·∫≠p s·ª± ki·ªán cho ƒëi·ªán tho·∫°i m·ªõi
                this.setupPhoneEvents(phoneElement, deviceId);

                console.log('üì± ƒê√£ t·∫°o ƒëi·ªán tho·∫°i cho thi·∫øt b·ªã:', deviceId);
                return phoneElement;
            }

            setupPhoneEvents(phoneElement, deviceId) {
                // CH·ªà th√™m s·ª± ki·ªán v√†o screen-image-container, kh√¥ng ph·∫£i to√†n b·ªô phone-screen
                const screenImageContainer = phoneElement.querySelector('.screen-image-container');
                const screenImage = phoneElement.querySelector('.screen-image');
                const phoneControls = phoneElement.querySelector('.phone-controls');

                // Touch events v·ªõi passive: false ƒë·ªÉ c√≥ th·ªÉ preventDefault
                screenImageContainer.addEventListener('touchstart', (e) => {
                    this.handleTouchStart(e, deviceId);
                    e.preventDefault();
                }, { passive: false });

                screenImageContainer.addEventListener('touchmove', (e) => {
                    this.handleTouchMove(e, deviceId);
                    e.preventDefault();
                }, { passive: false });

                screenImageContainer.addEventListener('touchend', (e) => {
                    this.handleTouchEnd(e, deviceId);
                    e.preventDefault();
                }, { passive: false });

                screenImageContainer.addEventListener('touchcancel', (e) => {
                    this.handleTouchEnd(e, deviceId);
                    e.preventDefault();
                }, { passive: false });

                // Mouse events cho desktop
                screenImageContainer.addEventListener('mousedown', (e) => {
                    this.handleMouseStart(e, deviceId);
                    e.preventDefault();
                });

                screenImageContainer.addEventListener('mousemove', (e) => {
                    if (e.buttons === 1) { // Ch·ªâ khi ƒëang gi·ªØ chu·ªôt tr√°i
                        this.handleMouseMove(e, deviceId);
                        e.preventDefault();
                    }
                });

                screenImageContainer.addEventListener('mouseup', (e) => {
                    this.handleMouseEnd(e, deviceId);
                    e.preventDefault();
                });

                screenImageContainer.addEventListener('mouseleave', (e) => {
                    this.handleMouseEnd(e, deviceId);
                    e.preventDefault();
                });

                // Th√™m s·ª± ki·ªán cho h√¨nh ·∫£nh m√†n h√¨nh
                screenImage.addEventListener('touchstart', (e) => {
                    // NgƒÉn kh√¥ng cho s·ª± ki·ªán lan truy·ªÅn n·∫øu ƒë√£ x·ª≠ l√Ω ·ªü container
                    if (e.target === screenImage) {
                        this.handleTouchStart(e, deviceId);
                        e.preventDefault();
                    }
                }, { passive: false });

                screenImage.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    return false;
                });

                // Th√™m s·ª± ki·ªán cho c√°c n√∫t ƒëi·ªÅu khi·ªÉn - RI√äNG BI·ªÜT
                const controlButtons = phoneElement.querySelectorAll('.control-btn');
                controlButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation(); // NgƒÉn kh√¥ng cho s·ª± ki·ªán lan truy·ªÅn l√™n container
                        const key = btn.getAttribute('data-key');
                        if (key) {
                            this.sendKey(key, deviceId);
                        }
                    });

                    // NgƒÉn touch events tr√™n c√°c n√∫t
                    btn.addEventListener('touchstart', (e) => {
                        e.stopPropagation(); // QUAN TR·ªåNG: NgƒÉn kh√¥ng cho touch lan truy·ªÅn
                    }, { passive: true });

                    btn.addEventListener('touchend', (e) => {
                        e.stopPropagation(); // QUAN TR·ªåNG: NgƒÉn kh√¥ng cho touch lan truy·ªÅn
                    }, { passive: true });
                });

                // NgƒÉn touch events tr√™n to√†n b·ªô phone-controls
                phoneControls.addEventListener('touchstart', (e) => {
                    e.stopPropagation(); // NgƒÉn kh√¥ng cho touch lan truy·ªÅn l√™n container
                }, { passive: true });

                phoneControls.addEventListener('touchend', (e) => {
                    e.stopPropagation(); // NgƒÉn kh√¥ng cho touch lan truy·ªÅn l√™n container
                }, { passive: true });
            }

            handleTouchStart(e, deviceId) {
                if (!this.isConnected || !deviceId) return;

                e.preventDefault();
                const phoneElement = this.phoneElements.get(deviceId);
                if (!phoneElement) return;

                const screenImage = phoneElement.querySelector('.screen-image');

                // Ki·ªÉm tra xem ·∫£nh ƒë√£ load ch∆∞a
                if (!screenImage.src || screenImage.style.display === 'none') {
                    console.log('‚ö†Ô∏è Ch∆∞a c√≥ ·∫£nh m√†n h√¨nh ƒë·ªÉ t∆∞∆°ng t√°c');
                    return;
                }

                for (let touch of e.changedTouches) {
                    const coords = this.getTouchCoordinates(touch, phoneElement.querySelector('.phone-screen'), deviceId);
                    const touchId = touch.identifier;

                    // Debug chi ti·∫øt
                    this.debugTouchCoordinates(touch, coords, deviceId);

                    this.touches.set(touchId, {
                        startX: coords.x,
                        startY: coords.y,
                        lastX: coords.x,
                        lastY: coords.y,
                        startTime: Date.now(),
                        deviceId: deviceId
                    });

                    this.showTouchIndicator(touch.clientX, touch.clientY, phoneElement);
                    this.sendTouchEvent('down', coords.x, coords.y, touchId, deviceId);
                }
            }

            handleTouchMove(e, deviceId) {
                if (!this.isConnected || !deviceId) return;

                e.preventDefault();
                const phoneElement = this.phoneElements.get(deviceId);
                if (!phoneElement) return;

                const screenImage = phoneElement.querySelector('.screen-image');

                for (let touch of e.changedTouches) {
                    const touchId = touch.identifier;
                    const touchData = this.touches.get(touchId);

                    if (touchData && touchData.deviceId === deviceId) {
                        const coords = this.getTouchCoordinates(touch, phoneElement.querySelector('.phone-screen'), deviceId);

                        // V·∫Ω ƒë∆∞·ªùng k√©o v·ªõi t·ªça ƒë·ªô hi·ªÉn th·ªã
                        const screenRect = phoneElement.querySelector('.phone-screen').getBoundingClientRect();
                        const displayX = touch.clientX - screenRect.left;
                        const displayY = touch.clientY - screenRect.top;

                        // S·ª≠ d·ª•ng cache t·ªça ƒë·ªô hi·ªÉn th·ªã thay v√¨ t√≠nh to√°n
                        if (touchData.lastDisplayX !== undefined && touchData.lastDisplayY !== undefined) {
                            this.drawSwipeTrail(touchData.lastDisplayX, touchData.lastDisplayY, displayX, displayY, phoneElement);
                        }

                        // Cache t·ªça ƒë·ªô hi·ªÉn th·ªã cho l·∫ßn sau
                        touchData.lastDisplayX = displayX;
                        touchData.lastDisplayY = displayY;

                        // C·∫≠p nh·∫≠t v·ªã tr√≠ th·ª±c c·ªßa ·∫£nh
                        touchData.lastX = coords.x;
                        touchData.lastY = coords.y;

                        // G·ª≠i s·ª± ki·ªán di chuy·ªÉn v·ªõi t·ªça ƒë·ªô th·ª±c c·ªßa ·∫£nh
                        this.sendTouchEvent('move', coords.x, coords.y, touchId, deviceId);
                    }
                }

                // X·ª≠ l√Ω c·ª≠ ch·ªâ ƒëa ƒëi·ªÉm
                if (e.touches.length === 2) {
                    this.handleMultiTouchGesture(e, deviceId);
                }
            }

            handleTouchEnd(e, deviceId) {
                if (!this.isConnected || !deviceId) {
                    return;
                }

                e.preventDefault();
                const phoneElement = this.phoneElements.get(deviceId);
                if (!phoneElement) return;

                for (let touch of e.changedTouches) {
                    const touchId = touch.identifier;
                    const touchData = this.touches.get(touchId);

                    if (touchData && touchData.deviceId === deviceId) {
                        // L·∫•y t·ªça ƒë·ªô th·ª±c c·ªßa ·∫£nh t·ª´ cache
                        const coords = {
                            x: touchData.lastX,
                            y: touchData.lastY
                        };

                        // G·ª≠i s·ª± ki·ªán nh·∫£ v·ªõi t·ªça ƒë·ªô th·ª±c c·ªßa ·∫£nh
                        this.sendTouchEvent('up', coords.x, coords.y, touchId, deviceId);

                        // X√≥a touch data
                        this.touches.delete(touchId);
                    }
                }

                // X√≥a t·∫•t c·∫£ swipe trails khi k·∫øt th√∫c
                this.clearSwipeTrails(phoneElement);
            }

            debugTouchCoordinates(touch, calculatedCoords, deviceId) {
                const phoneElement = this.phoneElements.get(deviceId);
                if (!phoneElement) return;

                const screenImage = phoneElement.querySelector('.screen-image');
                const phoneScreen = phoneElement.querySelector('.phone-screen');
                const screenRect = phoneScreen.getBoundingClientRect();

                const imgNaturalWidth = screenImage.naturalWidth;
                const imgNaturalHeight = screenImage.naturalHeight;

                if (!imgNaturalWidth || !imgNaturalHeight) return;

                // T√≠nh to√°n k√≠ch th∆∞·ªõc hi·ªÉn th·ªã th·ª±c t·∫ø
                const containerWidth = screenRect.width;
                const containerHeight = screenRect.height;
                const imgAspect = imgNaturalWidth / imgNaturalHeight;
                const containerAspect = containerWidth / containerHeight;

                let displayedWidth, displayedHeight, offsetX, offsetY;

                if (imgAspect > containerAspect) {
                    displayedWidth = containerWidth;
                    displayedHeight = containerWidth / imgAspect;
                    offsetX = 0;
                    offsetY = (containerHeight - displayedHeight) / 2;
                } else {
                    displayedHeight = containerHeight;
                    displayedWidth = containerHeight * imgAspect;
                    offsetX = (containerWidth - displayedWidth) / 2;
                    offsetY = 0;
                }

                console.log('üîç DEBUG T·ªåA ƒê·ªò CHI TI·∫æT:', {
                    'Device': deviceId,
                    'V√πng hi·ªÉn th·ªã': {
                        'Phone Screen': `${Math.round(screenRect.width)}x${Math.round(screenRect.height)}`,
                        '·∫¢nh th·ª±c t·∫ø': `${imgNaturalWidth}x${imgNaturalHeight}`,
                        '·∫¢nh hi·ªÉn th·ªã': `${Math.round(displayedWidth)}x${Math.round(displayedHeight)}`,
                        'Offset': `(${Math.round(offsetX)}, ${Math.round(offsetY)})`
                    },
                    'V·ªã tr√≠ ch·∫°m': {
                        'Tuy·ªát ƒë·ªëi': `(${Math.round(touch.clientX)}, ${Math.round(touch.clientY)})`,
                        'T∆∞∆°ng ƒë·ªëi PhoneScreen': `(${Math.round(touch.clientX - screenRect.left)}, ${Math.round(touch.clientY - screenRect.top)})`,
                        'T∆∞∆°ng ƒë·ªëi ·∫¢nh': `(${Math.round((touch.clientX - screenRect.left - offsetX))}, ${Math.round((touch.clientY - screenRect.top - offsetY))})`
                    },
                    'T·ªça ƒë·ªô ·∫£nh g·ªëc': `(${calculatedCoords.x}, ${calculatedCoords.y})`,
                    'T·ª∑ l·ªá %': {
                        x: imgNaturalWidth > 0 ? ((calculatedCoords.x / imgNaturalWidth) * 100).toFixed(1) + '%' : 'N/A',
                        y: imgNaturalHeight > 0 ? ((calculatedCoords.y / imgNaturalHeight) * 100).toFixed(1) + '%' : 'N/A'
                    }
                });
            }

            sendTouchEvent(type, x, y, touchId, deviceId) {
                const phoneElement = this.phoneElements.get(deviceId);
                if (!phoneElement) return;

                const screenImage = phoneElement.querySelector('.screen-image');

                console.log(`üìç ${type.toUpperCase()} t·∫°i:`, {
                    'Device': deviceId,
                    'T·ªça ƒë·ªô ·∫£nh': `(${x}, ${y})`,
                    'K√≠ch th∆∞·ªõc ·∫£nh': `${screenImage.naturalWidth}x${screenImage.naturalHeight}`,
                    'T·ª∑ l·ªá': {
                        x: screenImage.naturalWidth > 0 ? (x / screenImage.naturalWidth * 100).toFixed(1) + '%' : 'N/A',
                        y: screenImage.naturalHeight > 0 ? (y / screenImage.naturalHeight * 100).toFixed(1) + '%' : 'N/A'
                    }
                });

                const command = {
                    device_id: deviceId,
                    type: 'touch',
                    command: type,
                    data: {
                        x: Math.round(x),
                        y: Math.round(y),
                        touch_id: touchId,
                        pressure: 1.0,
                        timestamp: Date.now(),
                        // Th√™m th√¥ng tin v·ªÅ k√≠ch th∆∞·ªõc ·∫£nh ƒë·ªÉ server c√≥ th·ªÉ verify
                        image_width: screenImage.naturalWidth,
                        image_height: screenImage.naturalHeight
                    }
                };

                this.socket.emit('control_command', command);
            }

            sendGestureEvent(gesture, data, deviceId) {
                const command = {
                    device_id: deviceId,
                    type: 'gesture',
                    command: gesture,
                    data: data
                };

                this.socket.emit('control_command', command);
            }

            showTouchIndicator(x, y, phoneElement) {
                const indicator = document.createElement('div');
                indicator.className = 'touch-indicator';
                indicator.style.left = x + 'px';
                indicator.style.top = y + 'px';

                phoneElement.querySelector('.phone-screen').appendChild(indicator);

                // T·ª± ƒë·ªông x√≥a sau animation
                setTimeout(() => {
                    if (indicator.parentNode) {
                        indicator.parentNode.removeChild(indicator);
                    }
                }, 300);
            }

            handleMouseMove(e, deviceId) {
                if (!this.isConnected || !deviceId) {
                    return;
                }

                const phoneElement = this.phoneElements.get(deviceId);
                if (!phoneElement) return;

                const screenImage = phoneElement.querySelector('.screen-image');
                const touchData = this.touches.get(0);

                if (touchData && touchData.deviceId === deviceId && e.buttons === 1) {
                    const coords = this.getTouchCoordinates(e, phoneElement.querySelector('.phone-screen'), deviceId);

                    // V·∫Ω ƒë∆∞·ªùng k√©o v·ªõi t·ªça ƒë·ªô hi·ªÉn th·ªã (kh√¥ng c·∫ßn t√≠nh scale ph·ª©c t·∫°p)
                    const screenRect = phoneElement.querySelector('.phone-screen').getBoundingClientRect();
                    const displayX = e.clientX - screenRect.left;
                    const displayY = e.clientY - screenRect.top;

                    // L·∫•y t·ªça ƒë·ªô hi·ªÉn th·ªã c·ªßa ƒëi·ªÉm tr∆∞·ªõc ƒë√≥ t·ª´ cache
                    if (touchData.lastDisplayX !== undefined && touchData.lastDisplayY !== undefined) {
                        this.drawSwipeTrail(touchData.lastDisplayX, touchData.lastDisplayY, displayX, displayY, phoneElement);
                    }

                    // Cache t·ªça ƒë·ªô hi·ªÉn th·ªã cho l·∫ßn sau
                    touchData.lastDisplayX = displayX;
                    touchData.lastDisplayY = displayY;

                    // C·∫≠p nh·∫≠t v·ªã tr√≠ th·ª±c c·ªßa ·∫£nh
                    touchData.lastX = coords.x;
                    touchData.lastY = coords.y;

                    // G·ª≠i s·ª± ki·ªán di chuy·ªÉn v·ªõi t·ªça ƒë·ªô th·ª±c c·ªßa ·∫£nh
                    this.sendTouchEvent('move', coords.x, coords.y, 0, deviceId);
                }
            }

            handleMouseEnd(e, deviceId) {
                if (!this.isConnected || !deviceId) {
                    return;
                }

                const phoneElement = this.phoneElements.get(deviceId);
                if (!phoneElement) return;

                const screenImage = phoneElement.querySelector('.screen-image');
                const touchData = this.touches.get(0);

                if (touchData && touchData.deviceId === deviceId) {
                    const coords = this.getTouchCoordinates(e, phoneElement.querySelector('.phone-screen'), deviceId);
                    this.sendTouchEvent('up', coords.x, coords.y, 0, deviceId);
                    this.touches.delete(0);
                    this.clearSwipeTrails(phoneElement);
                }
            }

            handleMouseStart(e, deviceId) {
                if (!this.isConnected || !deviceId) {
                    return;
                }
                const phoneElement = this.phoneElements.get(deviceId);
                if (!phoneElement) return;

                const screenImage = phoneElement.querySelector('.screen-image');

                // Ki·ªÉm tra xem ·∫£nh ƒë√£ load ch∆∞a
                if (!screenImage.src || screenImage.style.display === 'none') {
                    console.log('‚ö†Ô∏è Ch∆∞a c√≥ ·∫£nh m√†n h√¨nh ƒë·ªÉ t∆∞∆°ng t√°c');
                    return;
                }
                const coords = this.getTouchCoordinates(e, phoneElement.querySelector('.phone-screen'), deviceId);
                const rect = e.currentTarget.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                // S·ª≠ d·ª•ng ID 0 cho mouse
                this.touches.set(0, {
                    startX: coords.x,
                    startY: coords.y,
                    lastX: coords.x,
                    lastY: coords.y,
                    startTime: Date.now(),
                    deviceId: deviceId
                });

                this.showTouchIndicator(x, y, phoneElement);
                this.sendTouchEvent('down', coords.x, coords.y, 0, deviceId);
            }

            handleMouseEnd(e, deviceId) {
                if (!this.isConnected || !deviceId) {
                    return;
                }

                const phoneElement = this.phoneElements.get(deviceId);
                if (!phoneElement) return;

                const screenImage = phoneElement.querySelector('.screen-image');
                const touchData = this.touches.get(0);

                if (touchData && touchData.deviceId === deviceId) {
                    const coords = this.getTouchCoordinates(e, phoneElement.querySelector('.phone-screen'), deviceId);
                    this.sendTouchEvent('up', coords.x, coords.y, 0, deviceId);
                    this.touches.delete(0);
                    this.clearSwipeTrails(phoneElement);
                }
            }

            getTouchCoordinates(touch, phoneScreen, deviceId) {
                const phoneElement = this.phoneElements.get(deviceId);
                if (!phoneElement) return { x: 0, y: 0 };

                const screenImage = phoneElement.querySelector('.screen-image');
                const screenImageContainer = phoneElement.querySelector('.screen-image-container');

                // S·ª≠ d·ª•ng container thay v√¨ phoneScreen
                const containerRect = screenImageContainer.getBoundingClientRect();

                // L·∫•y k√≠ch th∆∞·ªõc th·ª±c c·ªßa ·∫£nh
                const imgNaturalWidth = screenImage.naturalWidth;
                const imgNaturalHeight = screenImage.naturalHeight;

                // N·∫øu ch∆∞a c√≥ ·∫£nh ho·∫∑c ·∫£nh ch∆∞a load xong
                if (!imgNaturalWidth || !imgNaturalHeight || imgNaturalWidth === 0 || imgNaturalHeight === 0) {
                    console.log('‚ö†Ô∏è ·∫¢nh ch∆∞a s·∫µn s√†ng, s·ª≠ d·ª•ng t·ªça ƒë·ªô container');
                    return {
                        x: touch.clientX - containerRect.left,
                        y: touch.clientY - containerRect.top
                    };
                }

                // T√≠nh k√≠ch th∆∞·ªõc th·ª±c t·∫ø ·∫£nh ƒë∆∞·ª£c hi·ªÉn th·ªã (sau khi object-fit: contain)
                const containerWidth = containerRect.width;
                const containerHeight = containerRect.height;

                const imgAspect = imgNaturalWidth / imgNaturalHeight;
                const containerAspect = containerWidth / containerHeight;

                let displayedWidth, displayedHeight, offsetX, offsetY;

                if (imgAspect > containerAspect) {
                    // ·∫¢nh r·ªông h∆°n container -> fit theo width
                    displayedWidth = containerWidth;
                    displayedHeight = containerWidth / imgAspect;
                    offsetX = 0;
                    offsetY = (containerHeight - displayedHeight) / 2;
                } else {
                    // ·∫¢nh cao h∆°n container -> fit theo height
                    displayedHeight = containerHeight;
                    displayedWidth = containerHeight * imgAspect;
                    offsetX = (containerWidth - displayedWidth) / 2;
                    offsetY = 0;
                }

                // T√≠nh t·ª∑ l·ªá scale
                const scaleX = imgNaturalWidth / displayedWidth;
                const scaleY = imgNaturalHeight / displayedHeight;

                // V·ªã tr√≠ ch·∫°m t∆∞∆°ng ƒë·ªëi v·ªõi container
                const relativeX = touch.clientX - containerRect.left;
                const relativeY = touch.clientY - containerRect.top;

                // Ki·ªÉm tra xem ch·∫°m c√≥ n·∫±m trong v√πng ·∫£nh kh√¥ng
                const isInImageBounds = (
                    relativeX >= offsetX &&
                    relativeX <= offsetX + displayedWidth &&
                    relativeY >= offsetY &&
                    relativeY <= offsetY + displayedHeight
                );

                if (!isInImageBounds) {
                    console.log('‚ùå Ch·∫°m ngo√†i v√πng ·∫£nh hi·ªÉn th·ªã', {
                        'relative': `(${relativeX}, ${relativeY})`,
                        'imageBounds': {
                            x: `[${offsetX}, ${offsetX + displayedWidth}]`,
                            y: `[${offsetY}, ${offsetY + displayedHeight}]`
                        }
                    });
                    return { x: 0, y: 0 };
                }

                // T√≠nh t·ªça ƒë·ªô th·ª±c tr√™n ·∫£nh g·ªëc
                const imageX = (relativeX - offsetX) * scaleX;
                const imageY = (relativeY - offsetY) * scaleY;

                // ƒê·∫£m b·∫£o t·ªça ƒë·ªô n·∫±m trong ph·∫°m vi ·∫£nh
                const finalX = Math.max(0, Math.min(imageX, imgNaturalWidth - 1));
                const finalY = Math.max(0, Math.min(imageY, imgNaturalHeight - 1));

                return {
                    x: Math.round(finalX),
                    y: Math.round(finalY)
                };
            }

            showTouchIndicator(x, y, phoneElement) {
                const indicator = document.createElement('div');
                indicator.className = 'touch-indicator';
                indicator.style.left = x + 'px';
                indicator.style.top = y + 'px';

                phoneElement.querySelector('.phone-screen').appendChild(indicator);

                // T·ª± ƒë·ªông x√≥a sau animation
                setTimeout(() => {
                    if (indicator.parentNode) {
                        indicator.parentNode.removeChild(indicator);
                    }
                }, 300);
            }

            drawSwipeTrail(fromX, fromY, toX, toY, phoneElement) {
                const trail = document.createElement('div');
                trail.className = 'swipe-trail';

                const distance = Math.sqrt(Math.pow(toX - fromX, 2) + Math.pow(toY - fromY, 2));
                const angle = Math.atan2(toY - fromY, toX - fromX) * 180 / Math.PI;

                // Gi·ªõi h·∫°n k√≠ch th∆∞·ªõc
                const maxWidth = 8;
                const minWidth = 2;
                const trailWidth = Math.max(minWidth, Math.min(maxWidth, distance / 10));

                trail.style.width = distance + 'px';
                trail.style.height = trailWidth + 'px';
                trail.style.left = fromX + 'px';
                trail.style.top = fromY + 'px';
                trail.style.transform = `rotate(${angle}deg)`;
                trail.style.transformOrigin = 'left center';
                trail.style.filter = 'blur(1px)';

                phoneElement.querySelector('.phone-screen').appendChild(trail);

                // T·ª± ƒë·ªông x√≥a sau 1 gi√¢y
                setTimeout(() => {
                    if (trail.parentNode) {
                        trail.parentNode.removeChild(trail);
                    }
                }, 100);
            }

            clearSwipeTrails(phoneElement) {
                const trails = phoneElement.querySelectorAll('.swipe-trail');
                trails.forEach(trail => {
                    if (trail.parentNode) {
                        trail.parentNode.removeChild(trail);
                    }
                });
            }

            showGestureIndicator(type, message, phoneElement) {
                const indicator = phoneElement.querySelector(`.gesture-${type}`);
                if (indicator) {
                    indicator.textContent = message;
                    indicator.style.opacity = '1';
                    setTimeout(() => {
                        indicator.style.opacity = '0';
                    }, 2000);
                }
            }

            sendTouchEvent(type, x, y, touchId, deviceId) {
                const phoneElement = this.phoneElements.get(deviceId);
                if (!phoneElement) return;

                const screenImage = phoneElement.querySelector('.screen-image');

                console.log(`üìç ${type.toUpperCase()} t·∫°i:`, {
                    'Device': deviceId,
                    'T·ªça ƒë·ªô ·∫£nh': `(${x}, ${y})`,
                    'K√≠ch th∆∞·ªõc ·∫£nh': `${screenImage.naturalWidth}x${screenImage.naturalHeight}`,
                    'T·ª∑ l·ªá': {
                        x: screenImage.naturalWidth > 0 ? (x / screenImage.naturalWidth * 100).toFixed(1) + '%' : 'N/A',
                        y: screenImage.naturalHeight > 0 ? (y / screenImage.naturalHeight * 100).toFixed(1) + '%' : 'N/A'
                    }
                });

                const command = {
                    device_id: deviceId,
                    type: 'touch',
                    command: type,
                    data: {
                        x: Math.round(x),
                        y: Math.round(y),
                        touch_id: touchId,
                        pressure: 1.0,
                        timestamp: Date.now(),
                        // Th√™m th√¥ng tin v·ªÅ k√≠ch th∆∞·ªõc ·∫£nh ƒë·ªÉ server c√≥ th·ªÉ verify
                        image_width: screenImage.naturalWidth,
                        image_height: screenImage.naturalHeight
                    }
                };

                this.socket.emit('control_command', command);
            }

            // C·∫≠p nh·∫≠t ph∆∞∆°ng th·ª©c removePhone
            removePhone(deviceId) {
                const phoneElement = document.getElementById(`phone-${deviceId}`);
                if (phoneElement && phoneElement.parentNode) {
                    phoneElement.parentNode.removeChild(phoneElement);
                    this.phoneElements.delete(deviceId);
                    this.visibleDevices.delete(deviceId);
                    this.deviceLatencies.delete(deviceId);
                    this.deviceStatuses.delete(deviceId);

                    // C·∫≠p nh·∫≠t l·∫°i danh s√°ch devices
                    this.devices = this.devices.filter(device => device.id !== deviceId);

                    // Render l·∫°i trang hi·ªán t·∫°i
                    this.renderCurrentPage();
                    this.updatePaginationControls();
                }
            }

            // C·∫≠p nh·∫≠t ph∆∞∆°ng th·ª©c refreshDevicesList
            refreshDevicesList() {
                if (this.socket) {
                    this.socket.emit('device_connected');
                }
            }

            // Th√™m ph∆∞∆°ng th·ª©c m·ªõi ƒë·ªÉ x·ª≠ l√Ω khi c√≥ thi·∫øt b·ªã m·ªõi k·∫øt n·ªëi
            addDevice(device) {
                // Ki·ªÉm tra xem device ƒë√£ t·ªìn t·∫°i ch∆∞a
                if (!this.devices.find(d => d.id === device.id)) {
                    this.devices.push(device);

                    // T√≠nh to√°n l·∫°i ph√¢n trang
                    this.totalPages = Math.max(1, Math.ceil(this.devices.length / this.devicesPerPage));

                    // N·∫øu ƒë√¢y l√† device ƒë·∫ßu ti√™n, chuy·ªÉn v·ªÅ trang 1
                    if (this.devices.length === 1) {
                        this.currentPage = 1;
                    }

                    // Render l·∫°i trang hi·ªán t·∫°i
                    this.renderCurrentPage();
                    this.updatePaginationControls();

                    // C·∫≠p nh·∫≠t tr·∫°ng th√°i
                    this.updateDeviceStatus(device.id, 'ƒê√£ k·∫øt n·ªëi');
                    this.updateDeviceLatency(device.id, 0);
                }
            }

            // Th√™m ph∆∞∆°ng th·ª©c m·ªõi ƒë·ªÉ x·ª≠ l√Ω khi thi·∫øt b·ªã ng·∫Øt k·∫øt n·ªëi
            removeDevice(deviceId) {
                // X√≥a device kh·ªèi danh s√°ch
                this.devices = this.devices.filter(device => device.id !== deviceId);

                // Render l·∫°i trang hi·ªán t·∫°i
                this.renderCurrentPage();
                this.updatePaginationControls();
            }

            selectDevice(deviceId, event) {
                console.log('üéØ Ch·ªçn thi·∫øt b·ªã:', deviceId);
                this.socket.emit('select_device', { device_id: deviceId });

                // C·∫≠p nh·∫≠t UI ngay l·∫≠p t·ª©c
                document.querySelectorAll('.device-item').forEach(item => {
                    item.classList.remove('selected');
                });
                if (event && event.currentTarget) {
                    event.currentTarget.classList.add('selected');
                }
            }

            sendKey(key, deviceId) {
                if (!this.isConnected || !deviceId) {
                    alert('‚ö†Ô∏è Vui l√≤ng ch·ªçn m·ªôt thi·∫øt b·ªã tr∆∞·ªõc!');
                    return;
                }

                const command = {
                    device_id: deviceId,
                    type: 'key',
                    command: key,
                    data: { key }
                };

                this.socket.emit('control_command', command);
                console.log('‚å®Ô∏è G·ª≠i l·ªánh key:', command);
            }

            connectToServer() {
                console.log('üîÑ ƒêang k·∫øt n·ªëi ƒë·∫øn server...');
                this.socket = io();

                this.socket.on('connect', () => {
                    console.log('‚úÖ ƒê√£ k·∫øt n·ªëi ƒë·∫øn server');
                    this.updateStatus('‚úÖ ƒê√£ k·∫øt n·ªëi server', true);
                    this.socket.emit('register_viewer', {
                        type: 'web_viewer',
                        user_agent: navigator.userAgent
                    });
                });

                this.socket.on('disconnect', () => {
                    console.log('‚ùå M·∫•t k·∫øt n·ªëi server');
                    this.updateStatus('‚ùå M·∫•t k·∫øt n·ªëi server', false);
                    // C·∫≠p nh·∫≠t tr·∫°ng th√°i cho t·∫•t c·∫£ thi·∫øt b·ªã
                    this.phoneElements.forEach((element, deviceId) => {
                        this.updateDeviceStatus(deviceId, 'M·∫•t k·∫øt n·ªëi server');
                    });
                });

                this.socket.on('connect_error', (error) => {
                    console.error('‚ùå L·ªói k·∫øt n·ªëi:', error);
                    this.updateStatus('‚ùå L·ªói k·∫øt n·ªëi server', false);
                    this.phoneElements.forEach((element, deviceId) => {
                        this.updateDeviceStatus(deviceId, 'L·ªói k·∫øt n·ªëi');
                    });
                });

                this.socket.on('viewer_registered', (data) => {
                    console.log('‚úÖ ƒê√£ ƒëƒÉng k√Ω viewer th√†nh c√¥ng');
                    this.updateDevicesList(data.devices || []);
                });

                this.socket.on('screen_update', (data) => {
                    console.log('üì∫ Nh·∫≠n d·ªØ li·ªáu m√†n h√¨nh t·ª´:', data.device_id);
                    if (data.image_data) {
                        this.updateScreen(data.image_data, data.device_id);
                        // C·∫≠p nh·∫≠t tr·∫°ng th√°i khi nh·∫≠n ƒë∆∞·ª£c d·ªØ li·ªáu m√†n h√¨nh
                        this.updateDeviceStatus(data.device_id, 'ƒêang ho·∫°t ƒë·ªông');
                    }
                });

                this.socket.on('device_connected', (data) => {
                    console.log('üì± Thi·∫øt b·ªã m·ªõi k·∫øt n·ªëi:', data);
                    this.updateDeviceStatus(data.device_id, 'ƒê√£ k·∫øt n·ªëi');
                    this.refreshDevicesList();
                });

                this.socket.on('device_disconnected', (data) => {
                    console.log('üì± Thi·∫øt b·ªã ng·∫Øt k·∫øt n·ªëi:', data);
                    this.updateDeviceStatus(data.device_id, 'ƒê√£ ng·∫Øt k·∫øt n·ªëi');
                    setTimeout(() => {
                        this.removePhone(data.device_id);
                        this.refreshDevicesList();
                    }, 1000);
                });

                this.socket.on('device_selected', (data) => {
                    console.log('üéØ K·∫øt qu·∫£ ch·ªçn thi·∫øt b·ªã:', data);
                    if (data.status === 'success') {
                        this.selectedDevice = data.device_id;
                        this.selectedDeviceInfo = data.device_info;
                        this.updateSelectedDeviceDisplay();
                        this.updateDeviceStatus(data.device_id, 'ƒêang k·∫øt n·ªëi...');
                    }
                });

                // TH√äM: X·ª≠ l√Ω pong v·ªõi deviceId c·ª• th·ªÉ
                this.socket.on('pong', (data) => {
                    const now = Date.now();
                    const sentTime = new Date(data.timestamp).getTime();
                    const latency = now - sentTime;

                    if (data.device_id) {
                        // C√≥ deviceId c·ª• th·ªÉ - c·∫≠p nh·∫≠t cho thi·∫øt b·ªã ƒë√≥
                        this.updateDeviceLatency(data.device_id, latency);
                    } else {
                        // Kh√¥ng c√≥ deviceId - c·∫≠p nh·∫≠t cho t·∫•t c·∫£ (fallback)
                        this.phoneElements.forEach((element, deviceId) => {
                            this.updateDeviceLatency(deviceId, latency);
                        });
                    }
                });
            }

            startLatencyCheck() {
                setInterval(() => {
                    if (this.socket && this.socket.connected) {
                        // G·ª≠i ping cho t·∫•t c·∫£ thi·∫øt b·ªã ƒëang k·∫øt n·ªëi
                        this.phoneElements.forEach((element, deviceId) => {
                            this.socket.emit('ping', {
                                timestamp: new Date().toISOString(),
                                viewer_id: this.socket.id,
                                device_id: deviceId  // TH√äM device_id
                            });
                        });
                    }
                }, 2000);
            }

            updateStats() {
                document.getElementById('latency').textContent = `${this.latency}ms`;
            }

            updatePhoneStatus(statusText = null, deviceInfo = null) {
                // C·∫≠p nh·∫≠t tr·∫°ng th√°i cho t·∫•t c·∫£ c√°c ƒëi·ªán tho·∫°i
                this.phoneElements.forEach((phoneElement, deviceId) => {
                    if (statusText) {
                        this.updateDeviceStatus(deviceId, statusText);
                    } else {
                        this.updatePhoneStatusForDevice(deviceId);
                    }
                });
            }

            disconnect() {
                if (this.socket) {
                    this.socket.disconnect();
                    this.updateStatus('üîå ƒê√£ ng·∫Øt k·∫øt n·ªëi', false);
                    this.updatePhoneStatus('ƒê√£ ng·∫Øt k·∫øt n·ªëi');
                }
            }

            updateStatus(message, isConnected) {
                const statusElement = document.getElementById('status');
                statusElement.textContent = message;
                statusElement.className = `status ${isConnected ? 'connected' : 'disconnected'}`;
                this.isConnected = isConnected;
            }

            updateSelectedDeviceDisplay() {
                // ƒê√£ x√≥a ph·∫ßn hi·ªÉn th·ªã thi·∫øt b·ªã ƒëang ch·ªçn
            }
        }

        // Kh·ªüi t·∫°o viewer to√†n c·ª•c
        let viewer;

        // Kh·ªüi t·∫°o khi trang load xong
        document.addEventListener('DOMContentLoaded', function() {
            viewer = new RemoteViewer();
        });

        // Global functions
        window.selectDevice = function(deviceId, event) {
            if (viewer) {
                viewer.selectDevice(deviceId, event);
            }
        };

        window.sendKey = function(key) {
            if (viewer) viewer.sendKey(key);
        };

        window.takeScreenshot = function() {
            alert('üì∏ T√≠nh nƒÉng ch·ª•p m√†n h√¨nh ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn');
        };

        window.disconnect = function() {
            if (viewer) viewer.disconnect();
        };

        // Th√™m h√†m global cho ph√¢n trang
        window.goToPage = function(page) {
            if (viewer) viewer.goToPage(page);
        };
    </script>
</body>
</html>